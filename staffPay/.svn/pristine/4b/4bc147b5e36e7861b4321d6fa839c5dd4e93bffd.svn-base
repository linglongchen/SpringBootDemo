<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chunqiu.mrjuly.modules.hotelinfo.dao.HotelInfoDao">

    <sql id="hotelInfoColumns">
		a.id AS "id",
		a.hotel_groups AS "hotelGroups",
		a.hotel_name AS "hotelName",
		a.hotel_type AS "hotelType",
		a.hotel_address AS "hotelAddress",
		a.hotel_lng AS "hotelLng",
		a.hotel_lat AS "hotelLat",
		a.hotel_number AS "hotelNumber",
		a.hotel_acreage AS "hotelAcreage",
		a.hotel_price AS "hotelPrice",
		a.hotel_service AS "hotelService",
		a.hotel_ad_standard AS "hotelAdStandard",
		a.hotel_mall AS "hotelMall",
		a.hotel_traffic AS "hotelTraffic",
		a.hotel_img AS "hotelImg",
		a.bg_img AS "bgImg",
		a.hotel_slogan AS "hotelSlogan",
		a.remark AS "remark",
		a.is_freeze AS "isFreeze",
		a.create_date AS "createDate",
		a.create_by AS "createBy.id",
		a.update_date AS "updateDate",
		a.update_by AS "updateBy.id",
		a.hotel_code_id AS "hotelCodeId",
		a.hotel_star AS "hotelStar",
		a.picture_price AS "picturePrice",
		a.now_price2 AS "nowPrice2",
		a.video_price AS "videoPrice",
		a.total_price2 AS "totalPrice2",
		a.total_price AS "totalPrice",
		a.now_price AS "nowPrice",
		a.advertisement_num AS "advertisementNum",
		a.start_date AS "startDate",
		a.end_date AS "endDate2",
		a.end_date AS "endDate",
		a.province as "province",
		a.city as "city",
		a.area as "area",
		a.hotel_phone as "hotelPhone"
	</sql>
    <sql id="hotelInfoColumns2">
		a.id AS "id",
		a.hotel_groups AS "hotelGroups",
		a.hotel_name AS "hotelName",
		a.hotel_type AS "hotelType",
		a.hotel_address AS "hotelAddress",
		a.hotel_lng AS "hotelLng",
		a.hotel_lat AS "hotelLat",
		a.hotel_acreage AS "hotelAcreage",
		a.hotel_price AS "hotelPrice",
		a.hotel_service AS "hotelService",
		a.hotel_ad_standard AS "hotelAdStandard",
		a.hotel_mall AS "hotelMall",
		a.hotel_traffic AS "hotelTraffic",
		a.hotel_img AS "hotelImg",
		a.bg_img AS "bgImg",
		a.hotel_slogan AS "hotelSlogan",
		a.remark AS "remark",
		a.is_freeze AS "isFreeze",
		a.create_date AS "createDate",
		a.create_by AS "createBy.id",
		a.update_date AS "updateDate",
		a.update_by AS "updateBy.id",
		a.hotel_code_id AS "hotelCodeId",
		a.hotel_star AS "hotelStar",
		a.picture_price AS "picturePrice",
		a.now_price2 AS "nowPrice2",
		a.video_price AS "videoPrice",
		a.total_price2 AS "totalPrice2",
		a.total_price AS "totalPrice",
		a.now_price AS "nowPrice",
		a.advertisement_num AS "advertisementNum",
		a.start_date AS "startDate",
		a.end_date AS "endDate",
		a.province as "province",
		a.city as "city",
		a.area as "area"
	</sql>

    <sql id="hotelInfoJoins">
    </sql>


    <select id="get" resultType="HotelInfo">
        SELECT
        <include refid="hotelInfoColumns"/>
        FROM hotel_info a
        <include refid="hotelInfoJoins"/>
        WHERE a.id = #{id}
    </select>

    <select id="getHotelInfo" resultType="int">
        SELECT
        count(id)
        FROM ly_hotel_device_relation
        WHERE type = 1 and hotel_id = #{hotelCodeId}
    </select>
    <select id="getAllHotelInfo" resultType="int">
		SELECT
			count(id)
		FROM client_bianma_info
		WHERE type = 1
	</select>


    <select id="hotelInfoById" resultType="HotelInfo">
        SELECT
        <include refid="hotelInfoColumns"/>
        FROM hotel_info a
        <include refid="hotelInfoJoins"/>
        <where>

            <if test="id != null and id != ''">
                AND a.id = #{id}
            </if>
            <if test="hotelGroups != null and hotelGroups != ''">
                AND a.hotel_groups = #{hotelGroups}
            </if>
            <if test="hotelName != null and hotelName != ''">
                AND a.hotel_name = #{hotelName}
            </if>
            <if test="hotelType != null and hotelType != ''">
                AND a.hotel_type = #{hotelType}
            </if>
            <if test="hotelAddress != null and hotelAddress != ''">
                AND a.hotel_address = #{hotelAddress}
            </if>
            <if test="hotelLng != null and hotelLng != ''">
                AND a.hotel_lng = #{hotelLng}
            </if>
            <if test="hotelLat != null and hotelLat != ''">
                AND a.hotel_lat = #{hotelLat}
            </if>
            <if test="hotelNumber != null and hotelNumber != ''">
                AND a.hotel_number = #{hotelNumber}
            </if>
            <if test="hotelAcreage != null and hotelAcreage != ''">
                AND a.hotel_acreage = #{hotelAcreage}
            </if>
            <if test="hotelPrice != null and hotelPrice != ''">
                AND a.hotel_price = #{hotelPrice}
            </if>
            <if test="hotelService != null and hotelService != ''">
                AND a.hotel_service = #{hotelService}
            </if>
            <if test="hotelAdStandard != null and hotelAdStandard != ''">
                AND a.hotel_ad_standard = #{hotelAdStandard}
            </if>
            <if test="hotelMall != null and hotelMall != ''">
                AND a.hotel_mall = #{hotelMall}
            </if>
            <if test="hotelTraffic != null and hotelTraffic != ''">
                AND a.hotel_traffic = #{hotelTraffic}
            </if>
            <if test="hotelImg != null and hotelImg != ''">
                AND a.hotel_img = #{hotelImg}
            </if>
            <if test="bgImg != null and bgImg != ''">
                AND a.bg_img = #{bgImg}
            </if>
            <if test="hotelSlogan != null and hotelSlogan != ''">
                AND a.hotel_slogan = #{hotelSlogan}
            </if>
            <if test="remark != null and remark != ''">
                AND a.remark = #{remark}
            </if>
            <if test="isFreeze != null and isFreeze != ''">
                AND a.is_freeze = #{isFreeze}
            </if>
            <if test="createDate != null and createDate != ''">
                AND a.create_date = #{createDate}
            </if>
            <if test="createBy != null and createBy.id != null and createBy.id != ''">
                AND a.create_by = #{createBy.id}
            </if>
            <if test="updateDate != null and updateDate != ''">
                AND a.update_date = #{updateDate}
            </if>
            <if test="updateBy != null and updateBy.id != null and updateBy.id != ''">
                AND a.update_by = #{updateBy.id}
            </if>
            <if test="hotelCodeId != null ">
                AND a.hotel_code_id = #{hotelCodeId}
            </if>
            <if test="hotelStar != null ">
                AND a.hotel_star = #{hotelStar}
            </if>
            <if test="province != null and province != ''">
                AND a.province = #{province}
            </if>
            <if test="city != null and city != ''">
                AND a.city = #{city}
            </if>
            <if test="area != null and area != ''">
                AND a.area = #{area}
            </if>
            <if test="picturePrice != null and picturePrice != ''">
                AND a.picture_price = #{picturePrice}
            </if>
            <if test="videoPrice != null and videoPrice != ''">
                AND a.video_price = #{videoPrice}
            </if>
            <if test="totalPrice != null and totalPrice != ''">
                AND a.total_price = #{totalPrice}
            </if>
        </where>
        order by a.id desc
    </select>
    <select id="findList" resultType="HotelInfo">
        SELECT
        <include refid="hotelInfoColumns"/>
        FROM hotel_info a
        <include refid="hotelInfoJoins"/>
        <where>
            1=1 
            <if test="hotelName != null and hotelName != ''">
                AND a.hotel_name LIKE
                <if test="dbName == 'oracle'">'%'||#{hotelName}||'%'</if>
                <if test="dbName == 'mssql'">'%'+#{hotelName}+'%'</if>
                <if test="dbName == 'mysql'">concat('%',#{hotelName},'%')</if>
            </if>
            <if test="hotelStar != null">
                and a.hotel_star=#{hotelStar}
            </if>
        </where>
        <choose>
            <when test="orderBy != null and orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
                ORDER BY a.update_date DESC
            </otherwise>
        </choose>
    </select>
    <select id="findListHotel" resultType="HotelInfo">
        SELECT
        <include refid="hotelInfoColumns"/>
        FROM hotel_info a
        <include refid="hotelInfoJoins"/>
        <where>
            a.start_date is null and a.end_date is null and a.picture_price =0 and a.video_price=0 and a.total_price =0 and a.total_price2=0
            <if test="hotelName != null and hotelName != ''">
                AND a.hotel_name LIKE
                <if test="dbName == 'oracle'">'%'||#{hotelName}||'%'</if>
                <if test="dbName == 'mssql'">'%'+#{hotelName}+'%'</if>
                <if test="dbName == 'mysql'">concat('%',#{hotelName},'%')</if>
            </if>
        </where>
        <choose>
            <when test="orderBy != null and orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
                ORDER BY a.update_date DESC
            </otherwise>
        </choose>
    </select>

    <select id="findList2" resultType="HotelInfo">
        SELECT
        <include refid="hotelInfoColumns2"/>,
        (6 -(select count(id) from ly_hotel_advert_price where hotel_id = a.hotel_code_id and is_hotel = 1)) as "advertisementUploadNum"
        FROM shop_hotel h
        left join hotel_info a on h.hotel_code_id=a.hotel_code_id
        left join ly_hotel_advert_price l on l.hotel_id = a.hotel_code_id
        <include refid="hotelInfoJoins"/>
        <where>
            l.picture_price !=0 and l.video_price !=0 and l.picture_total_price !=0 and l.video_total_price!=0
            and h.shop_id=#{shopId} and h.status=3 and h.lease_term &gt;= DATE_FORMAT(NOW(),"%Y-%m-%d")
            and (6 -(select count(id) from ly_hotel_advert_price where hotel_id = a.hotel_code_id and is_hotel = 1)) != 0
            and (select count(id) from ly_hotel_device_relation where hotel_id = a.hotel_code_id and type = 1) != 0
            <if test="hotelCodeId != null">
                and a.hotel_code_id=#{hotelCodeId}
            </if>
            <if test="hotelName != null and hotelName != ''">
                AND a.hotel_name LIKE
                <if test="dbName == 'oracle'">'%'||#{hotelName}||'%'</if>
                <if test="dbName == 'mssql'">'%'+#{hotelName}+'%'</if>
                <if test="dbName == 'mysql'">concat('%',#{hotelName},'%')</if>
            </if>
        </where>
        GROUP BY l.hotel_id
        <choose>
            <when test="totalType == 5">
                order by a.total_price asc
            </when>
            <when test="totalType == 6">
                order by a.total_price desc
            </when>
            <when test="totalType == 7">
                order by a.total_price2 asc
            </when>
            <when test="totalType == 8 ">
                order by a.total_price2 desc
            </when>
            <when test="pictureType == 1">
                order by a.picture_price asc
            </when>
            <when test="pictureType == 2">
                order by a.picture_price desc
            </when>
            <when test="pictureType == 3">
                order by a.video_price asc
            </when>
            <when test="pictureType == 4">
                order by a.video_price desc
            </when>
            <when test="orderBy != null and orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <when test="hotelNumber == 1">
                ORDER BY a.hotel_number asc
            </when>
            <otherwise>

                ORDER BY a.hotel_number desc
            </otherwise>
        </choose>
    </select>
    <select id="findListAD" resultType="HotelInfo">
        SELECT
        <include refid="hotelInfoColumns2"/>,
        (6 -(select count(id) from ly_hotel_advert_price where hotel_id = a.hotel_code_id and is_hotel = 1)) as "advertisementUploadNum"
        FROM hotel_info a
        left join ly_hotel_advert_price l on l.hotel_id = a.hotel_code_id
        <include refid="hotelInfoJoins"/>
        <where>
            l.picture_price !=0 and l.video_price !=0 and l.picture_total_price !=0 and l.video_total_price!=0
            and (6 -(select count(id) from ly_hotel_advert_price where hotel_id = a.hotel_code_id and is_hotel = 1)) != 0
            and (select count(id) from ly_hotel_device_relation where hotel_id = a.hotel_code_id and type = 1) != 0
            <if test="hotelCodeId != null">
                and a.hotel_code_id=#{hotelCodeId}
            </if>
            <if test="hotelName != null and hotelName != ''">
                AND a.hotel_name LIKE
                <if test="dbName == 'oracle'">'%'||#{hotelName}||'%'</if>
                <if test="dbName == 'mssql'">'%'+#{hotelName}+'%'</if>
                <if test="dbName == 'mysql'">concat('%',#{hotelName},'%')</if>
            </if>
        </where>
        GROUP BY l.hotel_id
        <choose>
            <when test="totalType == 5">
                order by a.total_price asc
            </when>
            <when test="totalType == 6">
                order by a.total_price desc
            </when>
            <when test="totalType == 7">
                order by a.total_price2 asc
            </when>
            <when test="totalType == 8 ">
                order by a.total_price2 desc
            </when>
            <when test="pictureType == 1">
                order by a.picture_price asc
            </when>
            <when test="pictureType == 2">
                order by a.picture_price desc
            </when>
            <when test="pictureType == 3">
                order by a.video_price asc
            </when>
            <when test="pictureType == 4">
                order by a.video_price desc
            </when>
            <when test="orderBy != null and orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <when test="hotelNumber == 1">
                ORDER BY a.hotel_number asc
            </when>
            <otherwise>
                ORDER BY a.hotel_number desc
            </otherwise>
        </choose>
    </select>

    <select id="getUploadInfo" resultType="HotelInfo">
         SELECT
        a.hotel_code_id AS "hotelCodeId",
        j.picture_price AS "picturePrice",
        j.video_price AS "videoPrice",
        j.video_total_price AS "totalPrice2",
        j.picture_total_price AS "totalPrice",
        u.sort AS "sort",
        (select count(*) from advertising_upload) AS "count",
        a.start_date AS "startDate",
        a.end_date AS "endDate2"
        FROM advertising_upload u
        left join hotel_info a on u.hotel_id=a.hotel_code_id
        left join ly_hotel_advert_price j on j.upload_id = u.id
        WHERE u.hotel_id=#{hotelCodeId} and u.id=#{uploadId}
    </select>
    <select id="getDateOrder" resultType="java.lang.Float">
        select price_type_price AS "nowPrice"
        from advertising_order
        where date_format(put_in_time,'%Y-%m-%d')=#{date} and upload_id=#{uploadId} and delivery_type=1 and  pay_status=0 and auction_status=2
        order by price_type_price desc limit 1
    </select>
    <select id="getDateOrder2" resultType="java.lang.Float">
        select price_type_price AS "nowPrice2"
        from advertising_order
        where date_format(put_in_time,'%Y-%m-%d')=#{date} and upload_id=#{uploadId} and delivery_type=2 and  pay_status=0 and auction_status=2
        order by price_type_price desc limit 1
    </select>

    <select id="findList3" resultType="HotelInfo">
        SELECT
        u.id AS "id",
        a.hotel_code_id AS "hotelCodeId",
        j.picture_price AS "picturePrice",
        j.video_price AS "videoPrice",
        j.picture_total_price AS "totalPrice",
        j.video_total_price AS "totalPrice2",
        u.sort AS "sort",
        (select count(*) from advertising_upload) AS "count",
        u.now_price AS "nowPrice",
        u.now_price2 AS "nowPrice2",
        a.start_date AS "startDate",
        a.end_date AS "endDate2"
        FROM advertising_upload u
        left join hotel_info a on u.hotel_id=a.hotel_code_id
        left join ly_hotel_advert_price j on j.upload_id = u.id
        <include refid="hotelInfoJoins"/>
        <where>
            u.hotel_id=#{hotelCodeId} and u.status=1
            and j.is_hotel = 0
        </where>
        <choose>
            <when test="totalType == 1">
                order by u.now_price asc
            </when>
            <when test="totalType == 2 ">
                order by u.now_price desc
            </when>
            <when test="totalType == 3">
                order by u.now_price2 asc
            </when>
            <when test="totalType == 4">
                order by u.now_price2 desc
            </when>
            <when test="sort != null">
                order by u.sort asc
            </when>
            <when test="orderBy != null and orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
            </otherwise>
        </choose>
    </select>


    <select id="findAllList" resultType="HotelInfo">
        SELECT
        <include refid="hotelInfoColumns"/>,n.hotel_code AS "hotelCode"
        FROM hotel_info a
        LEFT JOIN hotel_unique_code n on n.id=a.hotel_code_id
        <include refid="hotelInfoJoins"/>
        <where>

        </where>
        <choose>
            <when test="orderBy != null and orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
                ORDER BY a.update_date DESC
            </otherwise>
        </choose>
    </select>

    <select id="findAllList9" resultType="com.chunqiu.mrjuly.modules.hotelinfo.model.HotelInfo">
		SELECT
		    hotel_code_id as "hotelCodeId",
            hotel_name as "hotelName"
        FROM
            hotel_info
        WHERE
            hotel_code_id NOT IN (
                SELECT
                    hotel_code_id
                FROM
                    shop_hotel
                WHERE
                    shop_id = #{id}
                AND STATUS = 3
                AND lease_term > date_format(now(), '%Y-%m-%d')
                GROUP BY hotel_code_id
	)
	</select>


    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO hotel_info(
						hotel_groups,
						hotel_name,
						hotel_type,
						hotel_address,
						hotel_number,
						hotel_acreage,
						hotel_price,
						hotel_service,
						hotel_ad_standard,
						hotel_mall,
						hotel_traffic,
						hotel_img,
						bg_img,
						hotel_slogan,
						create_date,
						create_by,
						hotel_code_id,
						hotel_star,
						hotel_lng,
						hotel_lat,
						province,
						city,
						area,
						start_date,
						end_date,
						picture_price,
						video_price,
						total_price,
						total_price2,
						hotel_phone
		) VALUES (
						#{hotelGroups},
						#{hotelName},
						#{hotelType},
						#{hotelAddress},
						#{hotelNumber},
						#{hotelAcreage},
						#{hotelPrice},
						#{hotelService},
						#{hotelAdStandardId},
						#{hotelMall},
						#{hotelTraffic},
						#{hotelImg},
						#{bgImg},
						#{hotelSlogan},
						#{createDate},
						#{createBy.id},
						#{createBy.hotelCodeId},
						#{hotelStar},
						#{hotelLng},
						#{hotelLat},
						#{province},
						#{city},
						#{area},
						#{startDate},
						#{endDate},
						0,
						0,
						0,
						0,
						#{hotelPhone}
		)
	</insert>

    <update id="update">
        UPDATE hotel_info
        <set>
            <if test="hotelGroups != null and hotelGroups != ''">
                hotel_groups = #{hotelGroups},
            </if>
            <if test="hotelName != null and hotelName != ''">
                hotel_name = #{hotelName},
            </if>
            <if test="hotelType != null and hotelType != ''">
                hotel_type = #{hotelType},
            </if>
            <if test="hotelAddress != null and hotelAddress != ''">
                hotel_address = #{hotelAddress},
            </if>
            <if test="hotelLng != null and hotelLng != ''">
                hotel_lng = #{hotelLng},
            </if>
            <if test="hotelLat != null and hotelLat != ''">
                hotel_lat = #{hotelLat},
            </if>
            <if test="hotelNumber != null">
                hotel_number = #{hotelNumber},
            </if>
            <if test="hotelAcreage != null">
                hotel_acreage = #{hotelAcreage},
            </if>
            <if test="hotelPrice != null and hotelPrice != ''">
                hotel_price = #{hotelPrice},
            </if>
            <if test="hotelService != null and hotelService != ''">
                hotel_service = #{hotelService},
            </if>
            <if test="hotelAdStandard != null and hotelAdStandard != ''">
                hotel_ad_standard = #{hotelAdStandardId},
            </if>
            <if test="hotelMall != null and hotelMall != ''">
                hotel_mall = #{hotelMall},
            </if>
            <if test="hotelTraffic != null and hotelTraffic != ''">
                hotel_traffic = #{hotelTraffic},
            </if>
            <if test="hotelImg != null and hotelImg != ''">
                hotel_img = #{hotelImg},
            </if>
            <if test="bgImg != null and bgImg != ''">
                bg_img = #{bgImg},
            </if>
            <if test="hotelSlogan != null and hotelSlogan != ''">
                hotel_slogan = #{hotelSlogan},
            </if>
            <if test="remark != null and remark != ''">
                remark = #{remark},
            </if>
            <if test="isFreeze != null">
                is_freeze = #{isFreeze},
            </if>
            <if test="createDate != null and createDate != ''">
                create_date = #{createDate},
            </if>
            <if test="createBy != null and createBy.id != null">
                create_by = #{createBy.id},
            </if>

            update_date =NOW(),

            <if test="updateBy != null and updateBy.id != null">
                update_by = #{updateBy.id},
            </if>
            <if test="hotelCodeId != null">
                hotel_code_id = #{hotelCodeId},
            </if>
            <if test="hotelStar != null">
                hotel_star = #{hotelStar},
            </if>
            <if test="picturePrice != null">
                picture_price = #{picturePrice},
            </if>
            <if test="videoPrice != null">
                video_price = #{videoPrice},
            </if>
            <if test="totalPrice != null">
                total_price = #{totalPrice},
            </if>
            <if test="totalPrice2 != null">
                total_price2 = #{totalPrice2},
            </if>
            <if test="advertisementNum != null and advertisementNum != ''">
                advertisement_num = #{advertisementNum},
            </if>
            <if test="hotelLat != null and hotelLat != ''">
                hotel_lat = #{hotelLat},
            </if>
            <if test="hotelLng != null and hotelLng != ''">
                hotel_lng = #{hotelLng},
            </if>
            <if test="freezeReason != null and freezeReason != ''">
                freeze_reason = #{freezeReason},
            </if>
            <if test="province != null and province != ''">
                province = #{province},
            </if>
            <if test="city != null and city != ''">
                city = #{city},
            </if>
            <if test="area != null and area != ''">
                area = #{area},
            </if>
            <if test="startDate != null and startDate != ''">
                start_date = #{startDate},
            </if>
            <if test="endDate != null and endDate != ''">
                end_date = #{endDate},
            </if>
            <if test="hotelPhone != null and hotelPhone != ''">
                hotel_phone = #{hotelPhone},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="delete">
		DELETE FROM hotel_info
		WHERE id = #{id}
	</update>

    <update id="updateNum">
		update hotel_info
		set advertisement_num =#{advertisementNum}
		where hotel_code_id=#{hotelCodeId}
	</update>


    <select id="menuListById" parameterType="MenuInfo" resultType="MenuInfo">
        <if test="type == 1">
            SELECT
            a.id,
            a.type_name AS "typeName",
            a.num
            FROM
            adviertisement_type as a
            WHERE
            a.id NOT IN ((SELECT
            type_id
            FROM
            ban_advertisement_type
            WHERE
            type_status = 1
            AND hotel_code_id = #{hotelCodeId}) )
        </if>
        <if test="type == 2">
            SELECT a.id, a.type2_name as "typeName" ,a.type2_num as "num" FROM adviertisement_type2 as a
            WHERE
            a.id NOT IN ((SELECT
            type_id
            FROM
            ban_advertisement_type
            WHERE
            type_status = 2
            AND hotel_code_id = #{hotelCodeId}) )  and a.type_id = #{id}
        </if>
        <if test="type == 3">
            SELECT id, type3_name as "typeName" ,type3_num as "num" FROM adviertisement_type3
            WHERE
            id NOT IN ((SELECT
            type_id
            FROM
            ban_advertisement_type
            WHERE
            type_status = 3
            AND hotel_code_id = #{hotelCodeId}) ) and type2_id = #{id}
        </if>
    </select>

    <select id="selectHotel" resultType="HotelInfo">
		SELECT
			b.hotel_code as "hotelCode",
			a.hotel_lng AS "hotelLng",
			a.hotel_lat AS "hotelLat",
			a.hotel_address AS "hotelAddress"
		FROM
			hotel_info a left join  hotel_unique_code  b on b.id = a.hotel_code_id  where a.hotel_code_id = #{hotelCodeId}
	</select>


    <select id="menuInfo" parameterType="MenuInfo" resultType="MenuInfo">
        <if test="type == 1">
            SELECT id, type_name as "typeName" ,num FROM adviertisement_type where id = #{id}
        </if>
        <if test="type == 2">
            SELECT id, type2_name as "typeName" ,type2_num as "num" FROM adviertisement_type2 WHERE id = #{id}
        </if>
        <if test="type == 3">
            SELECT id, type3_name as "typeName" ,type3_num as "num" FROM adviertisement_type3 WHERE id = #{id}
        </if>
    </select>


    <insert id="insertDepartmentById">
			INSERT INTO `department_info` (
				`hotel_code_id`,
				`department_name`,
				`create_date`,
				`create_by`,
				`department_head`
			)
			VALUES
				(
					#{hotelCodeId},
					#{departmentName},
					#{createDate},
					#{createBy.id},
					#{departmentHead}
				);
	</insert>
    <update id="changeFreezeAll" parameterType="list">
        update hotel_info
        <set>
            <foreach collection="list" item="item" separator=",">
                is_freeze=#{item.isFreeze},
                freeze_reason=#{item.freezeReason}
            </foreach>
        </set>
        where id in (
        <foreach collection="list" separator="," item="item">
            #{item.id}
        </foreach>
        )
    </update>
    <update id="updateAll" parameterType="list">
        update hotel_info
        <set>
            <foreach collection="list" item="item" separator=",">
                picture_price = #{item.picturePrice},
                video_price = #{item.videoPrice},
                total_price = #{item.totalPrice},
                total_price2 = #{item.totalPrice2},
                start_date = #{item.startDate},
                end_date=#{item.endDate}
            </foreach>
        </set>
        where id in (
        <foreach collection="list" separator="," item="item">
            #{item.id}
        </foreach>
        )
    </update>


    <insert id="serviceMode" parameterType="list">
        INSERT INTO `service_mode` (
        `service_mode`,
        `object_id`,
        `type`
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.serviceMode},
            #{item.objectId},
            #{item.type}
            )
        </foreach>

    </insert>


    <insert id="insertUploadAdver" parameterType="list">
        INSERT INTO `advertising_upload` (
        `sort`,
        `hotel_id`
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.sort},
            #{item.objectId}
            )
        </foreach>

    </insert>

    <select id="getSelectAdvertise" resultType="HotelInfo">
        select a.hotel_name AS "hotelName",
               a.hotel_number AS "hotelNumber",
        count(u.id) AS "count",
        a.advertisement_num AS "advertisementNum",
        a.hotel_code_id AS "hotelCodeId"
        from hotel_info a
        left join advertising_upload u on u.hotel_id =a.hotel_code_id
        where a.hotel_code_id=#{hotelCodeId}
    </select>
    <select id="getTime" resultType="HotelInfo">
        select CONCAT(start_date,"-",end_date) AS "time",hotel_code_id AS "hotelCodeId"
        from hotel_info
        where start_date is not null and end_date is not null
    </select>
    <select id="hotelServiceDateList" resultType="HotelInfo">
       SELECT
	  h.hotel_name AS "hotelName",
	  h.hotel_groups AS "hotelGroups",
	  h.id AS "id",
	  GROUP_CONCAT(i.shop_name SEPARATOR ',') As "shopName",
	  a.hotel_code_id AS "hotelCodeId"
      FROM
	  shop_hotel a
      LEFT JOIN shop_info i ON i.id = a.shop_id
      LEFT JOIN hotel_info h on h.hotel_code_id=a.hotel_code_id
      where a.hotel_code_id is not null and a.status=3
      GROUP BY a.hotel_code_id
      order by a.id desc
    </select>

    <select id="getShopType" resultType="ShopInfo">
        select id AS "id",shop_type AS "shopTypeName"
        from shop_type
    </select>
    <select id="getHotel" resultType="HotelInfo">
        select a.hotel_name AS "hotelName",
	           a.hotel_groups AS "hotelGroups",
	           a.hotel_code_id AS "hotelCodeId",
	           a.advertisement_num AS "advertisementNum"
	    from hotel_info a
	    where a.hotel_code_id=#{hotelCodeId}
    </select>
    <select id="getShopCount" resultType="Integer">
        select count(shop_id) AS "count"
        from shop_hotel
        <where>
            hotel_code_id=#{hotelCodeId} and status=3
            <if test="date != null and date != ''">
                AND date_format(create_date,'%Y-%m') =#{date}
            </if>
        </where>
    </select>
    <select id="getMyBill" resultType="MyBillInfo">
        SELECT
        sum(a.auction_amount) AS "amountPrice",
        (select count(id) from (select * from advertising_order a where hotel_code_id=#{id} and a.pay_status=2 and a.auction_status=3 and a.ordernumber is not null group by upload_id ) AS b ) AS  "shopNum",
        DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "createDate",
        DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "time",
        a.object_id as "objectId"
        from advertising_order a
        <where>
            a.hotel_code_id=#{id} and a.pay_status=2 and a.auction_status=3 and a.ordernumber is not null
            <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
                and DATE_FORMAT(a.create_date,'%Y-%m-%d') between #{startDate} and #{endDate}
            </if>
        </where>
        group by createDate
        order by a.id desc
    </select>
    <select id="getMy" resultType="MyBillInfo">
        SELECT a.status as "status",
        a.amount_price AS "amountPrice",
        count(*) AS "shopNum",
        DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "createDate",
        DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "time",
        a.object_id as "objectId"
        from my_bill_info a
        LEFT JOIN shop_hotel s on s.shop_id=a.object_id
        LEFT JOIN hotel_info i on i.hotel_code_id=s.hotel_code_id
        <where>
            i.hotel_code_id=#{hotelCodeId} and a.type=1
            <if test="time   !=null and  time  !=''">
                and  DATE_FORMAT(a.create_date,'%Y-%m-%d')=#{time}
            </if>
            <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
                and DATE_FORMAT(a.create_date,'%Y-%m-%d') between #{startDate} and #{endDate}
            </if>
            <if test="status != null">
                and a.status=#{status}
            </if>
        </where>
        group by createDate
        order by a.id desc
    </select>
    <select id="getMyBill2" resultType="MyBillInfo">
        SELECT a.status as "status",
        a.amount_price AS "amountPrice",
        DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "createDate",
        DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "time",
        a.object_id as "objectId",
        f.shop_name AS  "shopName",
        t.shop_type  AS "shopType"
        from my_bill_info a
        LEFT JOIN shop_hotel s on s.shop_id=a.object_id
        left join shop_info f on f.id=s.shop_id
        left join shop_type t on t.id=f.shop_type
        LEFT JOIN hotel_info i on i.hotel_code_id=s.hotel_code_id
        <where>
            i.hotel_code_id=#{hotelCodeId} and a.type=1 and DATE_FORMAT(s.lease_term,'%Y-%m-%d') &lt;NOW()
            <if test="time   !=null and  time  !=''">
                and  DATE_FORMAT(a.create_date,'%Y-%m-%d')=#{time}
            </if>
            <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
                and DATE_FORMAT(a.create_date,'%Y-%m-%d') between #{startDate} and #{endDate}
            </if>
            <if test="status != null">
                and a.status=#{status}
            </if>
        </where>
        order by a.id desc
    </select>

    <select id="getMyBill3" resultType="MyBillInfo">
        SELECT
        sum(a.auction_amount) AS "amountPrice",
        DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "createDate",
        DATE_FORMAT(a.create_date,'%Y-%m-%d') AS "time",
        a.object_id as "objectId",
        count(*) AS  "shopNum",
        a.price_type_price AS "price"
        from advertising_order a
        <where>
            a.hotel_code_id=#{id} and a.ordernumber is not null and a.pay_status=2 and a.auction_status=3
            <if test="time   !=null and  time  !=''">
                and  DATE_FORMAT(a.create_date,'%Y-%m-%d')=#{time}
            </if>
            <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
                and DATE_FORMAT(a.create_date,'%Y-%m-%d') between #{startDate} and #{endDate}
            </if>
        </where>
        group by a.price
        order by a.id desc
    </select>



    <select id="getCount" resultType="Float">
        select sum(a.amount_price) AS "countPrice"
        from my_bill_info a
        LEFT JOIN shop_hotel s on s.shop_id=a.object_id
        LEFT JOIN hotel_info i on i.hotel_code_id=s.hotel_code_id
        <where>
            i.hotel_code_id=#{id} and a.type=1 and DATE_FORMAT(s.lease_term,'%Y-%m-%d') &lt;NOW()
            <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
                and a.create_date between #{startDate} and #{endDate}
            </if>
            <if test="status != null">
                and a.status=#{status}
            </if>
        </where>
    </select>

    <select id="getCount6" resultType="Float">
        select sum(a.auction_amount) AS "countPrice"
        from advertising_order a
        <where>
            a.hotel_code_id=#{hotelCodeId} and a.ordernumber is not null and a.pay_status=2 and a.auction_status=3
            <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
                and a.create_date between #{startDate} and #{endDate}
            </if>
        </where>
    </select>
    <select id="getNewTime" resultType="java.lang.String">
        select create_date
        from advertising_order
        where type=#{type} and object_id=#{objectId}
        ORDER BY id DESC LIMIT 1
    </select>
    <update id="setState">
        UPDATE advertising_order
        SET state = 1
        WHERE
	    hour(TIMEDIFF(NOW(), payment_date)) >= #{time}
        AND state = 0 and pay_status=2
    </update>

    <!--<update id="changeUnicode">
        update unique_encoding
        set status=1
        where unique_encoding=#{uniqueEncoding}
    </update>-->
    <update id="changeUnicode">
        update ly_hotel_device_relation
        set connect_status=1
        where device_coding=#{uniqueEncoding}
    </update>

    <!--<update id="changeUnicode2">
        update unique_encoding
        set status=2
        where unique_encoding=#{uniqueEncoding}
    </update>-->
    <update id="changeUnicode2">
        update ly_hotel_device_relation
        set connect_status=2
        where device_coding=#{uniqueEncoding}
    </update>

    <select id="hotelName" resultType="HotelInfo">
      SELECT
            CONCAT(b.hotel_name ,"-",a.code) as "hotelName",
            b.hotel_img as "hotelImg"
        FROM
            ly_hotel_device_relation AS a
        LEFT JOIN hotel_info AS b ON b.hotel_code_id = a.hotel_id
        WHERE  a.device_coding =  #{codeName}
    </select>



    <select id="getAdvertisementOrder" resultType="java.lang.Integer">
        select  count(*)
        from advertising_order
        where hotel_code_id=#{hotelCodeId} and upload_id=#{uploadId} and pay_status in (1,2) and auction_status=3 and date_format(put_in_time,'%Y-%m-%d')=#{date}
    </select>
    <select id="getSort1" resultType="java.lang.Integer">
        select id
        from advertising_upload
        where hotel_id=#{hotelId} and sort=1
    </select>
    
    
    <select id="getAllHetelIdAndName"  resultType="com.chunqiu.mrjuly.modules.hotelinfo.model.HotelInfo">
        select id, hotel_name as "hotelName" 
        from hotel_info 
        order by create_date desc 
    </select>


    <!-- 1.5 版本-->

    <select id="getHotelCategoryListByName" resultType="HotelInfo">
        SELECT
        b.id as "id",
        b.hotel_name AS "hotelName",
        b.hotel_code AS "hotelCode",
        CONCAT(b.hotel_code, "S") AS "serviceCode",
        CONCAT(b.hotel_code, "C") AS "customerCode",
        (SELECT is_freeze  from hotel_info WHERE hotel_code_id = b.id) as "freezeStatus"
        FROM  hotel_unique_code as b
        WHERE
        b.de_flag = '0'
        <if test="nameStr != null and nameStr != '' ">
            AND (b.hotel_name LIKE CONCAT("%",#{nameStr},"%") or b.hotel_code LIKE CONCAT("%",#{nameStr},"%"))
        </if>
        <choose>
            <when test="orderBy != null and orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
                ORDER BY b.id DESC
            </otherwise>
        </choose>
    </select>

    <update id="updateHotelStatusById">
        update hotel_info
        set is_freeze = #{isFreeze}
        where hotel_code_id = #{id}
    </update>

    <select id="hotelInfoByName" resultType="HotelInfo">
        select hotel_code as "hotelCode", hotel_name as "hotelName" from hotel_unique_code
        where
        <if test="status == 1">
            <if test="hotelName != null and hotelName != '' ">
                  hotel_name = #{hotelName}
            </if>
        </if>
        <if test="status == 2">
            <if test="hotelCodeName != null and hotelCodeName != '' ">
                  hotel_code = #{hotelCodeName}
            </if>
        </if>
    </select>

    <insert id="insertCode">
        INSERT INTO `hotel_unique_code` (
            `hotel_code`,
            `hotel_name`,
            `create_date`,
            `create_by`
        )
        VALUES
            (
            #{hotelCodeName},
            #{hotelName},
            #{createDate},
            #{createBy.id}
            );
    </insert>

    <update id="updateCode">
        update hotel_unique_code
        set hotel_code = #{hotelCodeName}
        where id = #{id}
    </update>

    <select id="uploadCountNumById" resultType="int">
        select count(id) from ly_hotel_advert_price where hotel_id = #{hotelCodeId} and  is_hotel = 0;
    </select>

</mapper>

